# アーキテクチャ設計

## 設計方針

本プロジェクトは **DDD（ドメイン駆動設計）** を採用し、ビジネスロジック（ドメイン層）をフレームワーク（FastAPI 等）から分離する。

## レイヤー構成

```
src/llm_werewolf/
  domain/              ← ドメイン層（Python 標準ライブラリのみ依存）
    value_objects.py       値オブジェクト
    player.py              エンティティ
    game.py                集約ルート
    services.py            ドメインサービス
  main.py              ← インフラ層（FastAPI, Jinja2）
  templates/
```

### 依存の方向

```
インフラ層 (main.py) → ドメイン層 (domain/)
ドメイン層 → Python 標準ライブラリのみ
```

ドメイン層は FastAPI, Jinja2, LangChain 等の外部ライブラリに**一切依存しない**。

## DDD 構成要素

### 値オブジェクト (`value_objects.py`)

不変の型として `str, Enum` で定義する。同一性を持たず、値そのものが意味を持つ。

| クラス | 説明 |
|--------|------|
| `Team` | 陣営（`village`, `werewolf`） |
| `Role` | 役職（`villager`, `seer`, `werewolf`） |
| `Phase` | フェーズ（`day`, `night`） |
| `PlayerStatus` | 生存状態（`alive`, `dead`） |

### エンティティ (`player.py`)

一意な同一性（名前）を持ち、ライフサイクルの中で状態が変化するオブジェクト。

| クラス | 説明 |
|--------|------|
| `Player` | プレイヤー。名前・役職・生存状態を保持 |

### 集約ルート (`game.py`)

関連するエンティティと値オブジェクトをまとめ、整合性の境界を定義する。

| クラス | 説明 |
|--------|------|
| `GameState` | ゲーム全体の状態。プレイヤー一覧・フェーズ・日数・ログを保持 |

### ドメインサービス (`services.py`)

特定のエンティティに属さないビジネスロジックを関数として提供する。

| 関数 | 説明 |
|------|------|
| `assign_roles` | 配役ロジック（5人にランダムで役職を割り当て） |
| `create_game` | ゲーム初期化ファクトリ |
| `check_victory` | 勝利判定（人狼全滅→村人勝利、村人陣営≦人狼→人狼勝利） |

## 命名規則

コード上の命名は [用語集](glossary.md) に準拠する。
